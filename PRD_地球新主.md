# 地球新主（Earth Lord）产品需求文档（PRD）

## 文档信息

- **产品名称**: 地球新主（Earth Lord）
- **版本**: 1.0
- **文档日期**: 2025-12-23
- **平台**: iOS

---

## 1. 产品概述

### 1.1 产品定位

地球新主是一款基于真实地理位置（LBS）的末日生存策略游戏。玩家通过真实行走圈地、探索搜刮、建造发展，在废土世界中重建文明。

### 1.2 目标用户

- **核心用户**: 18-35岁，喜欢户外运动、策略游戏的用户
- **次级用户**: 喜欢收集、建造、社交类游戏的玩家
- **潜在用户**: 对AR/LBS类游戏感兴趣的用户（如宝可梦GO玩家）

### 1.3 产品价值主张

- **Walk to Earn**: 走路即可获得游戏资源，鼓励健康生活方式
- **真实圈地**: 用双脚在真实世界丈量土地，获得虚拟领地
- **末日生存**: 沉浸式的末日世界观，紧迫的生存压力
- **社交互动**: 基于位置的交易、聊天、联盟系统

---

## 2. 核心功能需求

### 2.1 用户系统

#### 2.1.1 登录注册

| 需求项      | 描述                       | 优先级 |
| -------- | ------------------------ | --- |
| 邮箱注册     | 支持邮箱+密码注册，含邮箱验证          | P0  |
| Apple登录  | 支持Sign in with Apple一键登录 | P0  |
| Google登录 | 支持Google账号OAuth登录        | P0  |
| 会话管理     | 支持多设备登录、自动登录             | P1  |
| 密码重置     | 支持忘记密码邮箱找回               | P1  |

#### 2.1.2 个人中心

| 需求项   | 描述                | 优先级 |
| ----- | ----------------- | --- |
| 用户档案  | 展示幸存者等级、存活天数、领地统计 | P0  |
| 设置页面  | 语言切换、通知设置、账户管理    | P1  |
| 多语言支持 | 支持简体中文、繁体中文、英文    | P1  |

---

### 2.2 圈地系统

#### 2.2.1 GPS圈地

| 需求项   | 描述                 | 优先级 |
| ----- | ------------------ | --- |
| 实时定位  | 使用GPS获取用户实时位置      | P0  |
| 轨迹绘制  | 用户移动时在地图上绘制蓝色轨迹线   | P0  |
| 多边形闭合 | 用户返回起点附近时自动闭合形成多边形 | P0  |
| 面积计算  | 计算闭合多边形的面积（平方米）    | P0  |
| 合法性校验 | 检测是否与他人领地重叠、是否作弊   | P0  |
| 卫星地图  | 使用苹果MapKit展示卫星地图   | P0  |

#### 2.2.2 领地管理

| 需求项   | 描述                     | 优先级 |
| ----- | ---------------------- | --- |
| 领地命名  | 支持给领地自定义名称             | P1  |
| 领地详情  | 展示面积、建筑数量、创建时间         | P0  |
| 交易开关  | 开启后允许100米内玩家查看交易挂单     | P1  |
| 活跃度要求 | 30天内需开始建设，90天保持活跃，否则回收 | P2  |

---

### 2.3 探索系统

#### 2.3.1 POI发现

| 需求项   | 描述                     | 优先级 |
| ----- | ---------------------- | --- |
| POI识别 | 自动识别用户附近的真实兴趣点（餐厅、超市等） | P0  |
| 地理围栏  | 进入POI范围时触发发现提示         | P0  |
| POI分类 | 根据POI类型分配对应资源类型        | P0  |

**POI资源对照表**:
| POI类型 | 产出资源 |
|---------|----------|
| 医院/药店 | 药品（急救包、抗生素） |
| 超市/餐厅 | 食物（罐头、饮用水） |
| 工厂/工地 | 金属材料 |
| 公园/林地 | 木材 |
| 银行/珠宝店 | 稀有材料 |

#### 2.3.2 搜刮机制

| 需求项  | 描述            | 优先级 |
| ---- | ------------- | --- |
| 搜刮操作 | 点击搜刮按钮获取资源    | P0  |
| 探索成就 | 记录探索距离、时长     | P1  |
| 冷却时间 | 同一POI搜刮后需等待冷却 | P1  |

---

### 2.4 背包系统

| 需求项  | 描述                 | 优先级 |
| ---- | ------------------ | --- |
| 物品存储 | 存储玩家获得的所有物资        | P0  |
| 容量限制 | 默认100格容量，可通过建仓库扩容  | P0  |
| 分类筛选 | 按物品类型筛选（食物、药品、材料等） | P1  |
| 本地优先 | 数据先存本地，异步同步云端，离线可用 | P1  |

---

### 2.5 建造系统

#### 2.5.1 建筑建造

| 需求项  | 描述             | 优先级 |
| ---- | -------------- | --- |
| 建筑菜单 | 展示可建造建筑列表及所需资源 | P0  |
| 资源检查 | 建造前检查资源是否充足    | P0  |
| 位置选择 | 拖拽选择建筑放置位置     | P0  |
| 资源扣除 | 建造成功后扣除相应资源    | P0  |

**建筑分类**:
| 分类 | 建筑示例 | 功能 |
|------|----------|------|
| 生存类 | 篝火、庇护所 | 取暖、休息 |
| 储存类 | 小仓库、中仓库 | 扩展背包容量 |
| 生产类 | 农田、工作台 | 生产资源 |
| 能源类 | 太阳能板、风力发电机 | 提供能源 |

#### 2.5.2 建筑状态

| 需求项  | 描述             | 优先级 |
| ---- | -------------- | --- |
| 状态机  | 建造中→待激活→运行中→损坏 | P0  |
| 升级功能 | 激活状态下可升级建筑     | P1  |
| 维护机制 | 定期维护，否则进入损坏状态  | P2  |

---

### 2.6 交易系统

| 需求项  | 描述                   | 优先级 |
| ---- | -------------------- | --- |
| 发布挂单 | 选择"我提供"和"我需要"的物品发布交易 | P0  |
| 挂单列表 | 查看附近玩家的交易挂单          | P0  |
| 接受交易 | 同意他人挂单完成物物交换         | P0  |
| 位置限制 | 需进入对方领地100米范围才能看到挂单  | P1  |

---

### 2.7 通讯系统

#### 2.7.1 消息中心

| 需求项  | 描述               | 优先级 |
| ---- | ---------------- | --- |
| 官方消息 | 接收生存指南、每日任务、官方公告 | P0  |
| 消息列表 | 分类展示消息，支持已读/未读标记 | P1  |

#### 2.7.2 公共频道

| 需求项  | 描述                         | 优先级 |
| ---- | -------------------------- | --- |
| 范围聊天 | 3km范围内玩家可见消息               | P0  |
| 实时推送 | 新消息秒级送达（Supabase Realtime） | P0  |
| 消息发送 | 支持文字消息发送                   | P0  |

#### 2.7.3 频道系统

| 需求项   | 描述            | 优先级 |
| ----- | ------------- | --- |
| 频道列表  | 展示频道名、距离、在线人数 | P0  |
| 创建频道  | 用户可创建自定义频道    | P1  |
| 加入/退出 | 支持加入和退出频道     | P0  |

#### 2.7.4 PTT呼叫

| 需求项  | 描述        | 优先级 |
| ---- | --------- | --- |
| 对讲功能 | 长按说话，松开发送 | P1  |
| 频率选择 | 可选择不同公共频道 | P1  |

#### 2.7.5 设备等级

| 需求项  | 描述          | 优先级 |
| ---- | ----------- | --- |
| 收音机  | 只能收听，不能发送   | P0  |
| 对讲机  | 收发功能，3km范围  | P0  |
| 营地电台 | 收发功能，10km范围 | P1  |
| 卫星通讯 | 全球范围通讯      | P2  |

---

### 2.8 生存体征

| 需求项  | 描述              | 优先级 |
| ---- | --------------- | --- |
| 核心生命 | 0-100，降到0死亡     | P0  |
| 饱食度  | 每小时-5，太低掉血      | P0  |
| 水分   | 每小时-10，太低掉血     | P0  |
| 增益机制 | 饱食度/水分>80%时获得增益 | P1  |
| 消耗物品 | 使用食物/水恢复对应数值    | P0  |

---

### 2.9 成就与排行

#### 2.9.1 成就系统

| 需求项  | 描述          | 优先级 |
| ---- | ----------- | --- |
| 成就列表 | 展示所有成就及完成进度 | P0  |
| 成就分类 | 新手/进阶/稀有成就  | P1  |
| 稀有度  | 普通→稀有→史诗→传说 | P1  |
| 奖励发放 | 完成成就获得金币奖励  | P0  |

#### 2.9.2 排行榜

| 需求项   | 描述        | 优先级 |
| ----- | --------- | --- |
| 领地面积榜 | 按总领地面积排名  | P0  |
| 探索废墟榜 | 按探索次数排名   | P0  |
| 建筑数量榜 | 按建筑总数排名   | P0  |
| 自我排名  | 展示玩家自己的排名 | P0  |

---

### 2.10 商业化系统

#### 2.10.1 订阅制

| 需求项   | 描述                | 优先级 |
| ----- | ----------------- | --- |
| 开拓者月卡 | $9.99/月，无限探索、范围扩大 | P0  |
| 领主通行证 | $19.99/月，所有特权     | P0  |

#### 2.10.2 一次性购买

| 需求项   | 描述    | 优先级 |
| ----- | ----- | --- |
| 初级物资包 | $0.99 | P0  |
| 中级物资包 | $2.99 | P0  |
| 稀有资源包 | $9.99 | P0  |

---

## 3. 非功能性需求

### 3.1 性能要求

- GPS定位精度：≤10米
- 消息推送延迟：≤1秒
- 排行榜查询响应：≤500ms
- 支持用户量：百万级

### 3.2 安全要求

- 用户密码加密存储
- OAuth令牌安全管理
- 防作弊检测（GPS欺骗检测）
- 交易防刷机制

### 3.3 可用性要求

- 支持离线模式（本地优先架构）
- 网络恢复后自动同步
- 支持多语言（中/英）

---

## 4. 技术架构

### 4.1 技术栈

| 层级   | 技术选型                 |
| ---- | -------------------- |
| 前端   | Swift/SwiftUI (iOS)  |
| 后端   | Supabase (BaaS)      |
| 数据库  | PostgreSQL + PostGIS |
| 地图服务 | Apple MapKit         |
| 支付   | StoreKit 2           |
| 实时通讯 | Supabase Realtime    |

### 4.2 核心代码模块

| 模块    | 文件                                                                   |
| ----- | -------------------------------------------------------------------- |
| 用户认证  | AuthManager.swift                                                    |
| 位置服务  | LocationManager.swift                                                |
| 领地管理  | TerritoryManager.swift                                               |
| POI管理 | POIManager.swift                                                     |
| 探索系统  | ExplorationManager.swift                                             |
| 物品管理  | ItemManager.swift                                                    |
| 建造系统  | BuildingManager.swift                                                |
| 交易系统  | TradeManager.swift                                                   |
| 通讯系统  | RadioManager.swift, CommunicationManager.swift, ChannelManager.swift |
| 内购支付  | StoreKitManager.swift                                                |
| 排行榜   | LeaderboardManager.swift                                             |
| 成就系统  | AchievementManager.swift                                             |
| 生存体征  | VitalSignsManagerV2.swift                                            |

---

## 5. 版本规划

### v1.0 (MVP)

- 登录注册系统
- GPS圈地核心功能
- POI发现与搜刮
- 背包系统
- 基础建造系统
- 生存体征系统

### v1.1

- 交易系统
- 公共频道聊天
- 成就系统
- 排行榜

### v1.2

- 频道管理
- PTT呼叫
- 设备升级系统

### v2.0

- 订阅付费系统
- 资源包内购
- 联盟系统
- 全球卫星通讯

---

## 6. 成功指标.   这是我第一次测试github同步

| 指标         | 目标值     |
| ---------- | ------- |
| 日活跃用户(DAU) | 10,000+ |
| 次日留存率      | ≥40%    |
| 7日留存率      | ≥20%    |
| 付费转化率      | ≥3%     |
| ARPU       | $2+     |
| 人均日行走步数提升  | +30%    |
